<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.8"/>
<title>EPICS Multi-Core Utilities: Rule-Based Thread Properties</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">EPICS Multi-Core Utilities
   &#160;<span id="projectnumber">1.2.1</span>
   </div>
   <div id="projectbrief">Real-Time Utilities for EPICS IOCs on Multi-Core Linux</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.8 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Modules</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Rule-Based Thread Properties</div>  </div>
</div><!--header-->
<div class="contents">

<p>Allow user-specified rules that modify real-time properties of EPICS threads.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="files"></a>
Files</h2></td></tr>
<tr class="memitem:thread_rules_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="thread_rules_8c.html">threadRules.c</a></td></tr>
<tr class="memdesc:thread_rules_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Rule-based modification of thread real-time properties. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga333954c6a31569816a724b222e5f0fb1"><td class="memItemLeft" align="right" valign="top">epicsShareFunc void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__threadrules.html#ga333954c6a31569816a724b222e5f0fb1">mcoreThreadModify</a> (epicsThreadId id, const char *policy, const char *priority, const char *cpus)</td></tr>
<tr class="memdesc:ga333954c6a31569816a724b222e5f0fb1"><td class="mdescLeft">&#160;</td><td class="mdescRight"><b>iocShell:</b> Modify a thread's real-time properties.  <a href="#ga333954c6a31569816a724b222e5f0fb1">More...</a><br /></td></tr>
<tr class="separator:ga333954c6a31569816a724b222e5f0fb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf806b02cc93c8809e5ebe7104a9d699b"><td class="memItemLeft" align="right" valign="top">epicsShareFunc void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__threadrules.html#gaf806b02cc93c8809e5ebe7104a9d699b">mcoreThreadRulesInit</a> ()</td></tr>
<tr class="memdesc:gaf806b02cc93c8809e5ebe7104a9d699b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialization routine.  <a href="#gaf806b02cc93c8809e5ebe7104a9d699b">More...</a><br /></td></tr>
<tr class="separator:gaf806b02cc93c8809e5ebe7104a9d699b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga18d12b853a486a8761c8e69a2169d550"><td class="memItemLeft" align="right" valign="top">epicsShareFunc long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__threadrules.html#ga18d12b853a486a8761c8e69a2169d550">mcoreThreadRuleAdd</a> (const char *name, const char *policy, const char *priority, const char *cpus, const char *pattern)</td></tr>
<tr class="memdesc:ga18d12b853a486a8761c8e69a2169d550"><td class="mdescLeft">&#160;</td><td class="mdescRight"><b>iocShell:</b> Add or replace a thread rule.  <a href="#ga18d12b853a486a8761c8e69a2169d550">More...</a><br /></td></tr>
<tr class="separator:ga18d12b853a486a8761c8e69a2169d550"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga82b39f3e0f24bed2e91885b4b96d9cb1"><td class="memItemLeft" align="right" valign="top">epicsShareFunc void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__threadrules.html#ga82b39f3e0f24bed2e91885b4b96d9cb1">mcoreThreadRuleDelete</a> (const char *name)</td></tr>
<tr class="memdesc:ga82b39f3e0f24bed2e91885b4b96d9cb1"><td class="mdescLeft">&#160;</td><td class="mdescRight"><b>iocShell:</b> Delete a thread rule.  <a href="#ga82b39f3e0f24bed2e91885b4b96d9cb1">More...</a><br /></td></tr>
<tr class="separator:ga82b39f3e0f24bed2e91885b4b96d9cb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gad22f782c58f3b2550b718cd3c25d7898"><td class="memItemLeft" align="right" valign="top">epicsShareFunc void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__threadrules.html#gad22f782c58f3b2550b718cd3c25d7898">mcoreThreadRulesShow</a> (void)</td></tr>
<tr class="memdesc:gad22f782c58f3b2550b718cd3c25d7898"><td class="mdescLeft">&#160;</td><td class="mdescRight"><b>iocShell:</b> Print a comprehensive list of the thread rules.  <a href="#gad22f782c58f3b2550b718cd3c25d7898">More...</a><br /></td></tr>
<tr class="separator:gad22f782c58f3b2550b718cd3c25d7898"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>Allow user-specified rules that modify real-time properties of EPICS threads. </p>
<p>Implements a library that uses rules to modify real-time properties of EPICS threads: </p><ul>
<li><em>Scheduling policy</em><br />
Scheduling mechanism used for this thread. When POSIX scheduling is enabled, the default mechanism is <code>SCHED_FIFO</code>, but <code>SCHED_OTHER</code> and <code>SCHED_RR</code> are also supported. </li>
<li><em>Scheduling priority</em><br />
OSI priority value that gets converted to the system's real-time priority schema. </li>
<li><em>CPU Affinity</em><br />
Set of CPUs that this thread is allowed to run on.</li>
</ul>
<p>This is achieved by creating a linked list of rules, which consist of a regular expression pattern and modification instructions. A hook function is added to the EPICS thread creation module. The hook is called from every thread as part of its creation, matches the regular expression patterns of all rules against the name of the newly created thread, and applies the modifications of all rules that match.</p>
<p>See man pages for <a href="http://www.kernel.org/doc/man-pages/online/pages/man3/pthread_setschedparam.3.html">pthread_setschedparam(3)</a> and <a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setscheduler.2.html">sched_setscheduler(2)</a> for details on scheduling policy and priority, <a href="http://www.kernel.org/doc/man-pages/online/pages/man3/pthread_setaffinity_np.3.html">pthread_setaffinity_np(3)</a> and <a href="http://www.kernel.org/doc/man-pages/online/pages/man2/sched_setaffinity.2.html">sched_setaffinity(2)</a> for details on CPU affinity.</p>
<dl class="section user"><dt>Configuration Files</dt><dd>The module tries to read a system configuration file (<code>/etc/rtrules</code>) and a user configuration file (default: <code>$HOME/.rtrules</code>) to create the initial list of thread rules. </dd></dl>
<dl class="section user"><dt></dt><dd>The file format is based on the format of the <code>/etc/rtgroups</code> file on RHEL-MRG. Each line has the format </dd></dl>
<dl class="section user"><dt></dt><dd><code><b>name:policy:priority:affinity:pattern</b></code> </dd></dl>
<dl class="section user"><dt></dt><dd><table  border="0">
<tr>
<td><code>name</code> </td><td>name of the rule </td></tr>
<tr>
<td><code>policy</code> </td><td>scheduling policy to set for the thread (first letter, not case sensitive), <code>*</code> = don't change <br />
 </td></tr>
<tr>
<td><code>priority</code> </td><td>scheduling priority to set for the thread (a <code>+</code> or <code>-</code> sign adds to the current priority), <code>*</code> = don't change </td></tr>
<tr>
<td><code>affinity</code> </td><td>CPUs to set the thread's affinity to (use <code></code>, and <code>-</code> to specify multiple CPUs and ranges, e.g. <code>0</code>,3-5), <code>*</code> = don't change </td></tr>
<tr>
<td><code>pattern</code> </td><td>regular expression pattern to match thread names against, see man page for <a href="http://www.kernel.org/doc/man-pages/online/pages/man7/regex.7.html">regex(7)</a> for details </td></tr>
</table>
</dd></dl>
<dl class="section user"><dt></dt><dd>Lines starting with <code>#</code> (comments), and empty lines (containing only whitespace) are ignored.</dd></dl>
<dl class="section user"><dt>Environment Variables</dt><dd><dl>
<dt><code>HOME</code> </dt>
<dd>location of the <code>HOME</code> directory (default: <code>/</code>) </dd>
<dt><code>EPICS_MCORE_USERCONFIG</code> </dt>
<dd>name of user configuration file, relative to the <code>HOME</code> directory (default: <code>.rtrules</code>) </dd>
</dl>
</dd></dl>
<dl class="section user"><dt>Linux Security</dt><dd>To change its scheduling policy and priority, under modern Linux systems the process must have an <code>rtprio</code> entry in the pam limits module configuration. </dd></dl>
<dl class="section user"><dt></dt><dd>See the <a href="http://linux.die.net/man/5/limits.conf">limits.conf(5)</a> man page for details.</dd></dl>
<dl class="section user"><dt>Known Issues</dt><dd>A thread calling <code>epicsThreadSetPriority()</code> to set its priority while running may override the priorities defined in the rules at any time. </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga333954c6a31569816a724b222e5f0fb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">epicsShareFunc void mcoreThreadModify </td>
          <td>(</td>
          <td class="paramtype">epicsThreadId&#160;</td>
          <td class="paramname"><em>id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cpus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><b>iocShell:</b> Modify a thread's real-time properties. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">id</td><td>EPICS thread id </td></tr>
    <tr><td class="paramname">policy</td><td>scheduling policy to set (<code>*</code> = don't change) </td></tr>
    <tr><td class="paramname">priority</td><td>scheduling priority (OSI) to set (a <code>+</code> or <code>-</code> sign adds to the current priority, <code>*</code> = don't change) </td></tr>
    <tr><td class="paramname">cpus</td><td>cpuset specification to set (use <code></code>, and <code>-</code> to specify multiple CPUs and ranges, <code>*</code> = don't change)</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>IOC Shell</dt><dd><code><b>mcoreThreadModify thread policy priority cpus</b></code> <table  border="0">
<tr>
<td><code>thread</code> </td><td>thread name or id </td></tr>
<tr>
<td><code>policy</code> </td><td>scheduling policy to set (<code>*</code> = don't change) </td></tr>
<tr>
<td><code>priority</code> </td><td>scheduling priority (OSI) to set (a <code>+</code> or <code>-</code> sign adds to the current priority, <code>*</code> = don't change) </td></tr>
<tr>
<td><code>cpus</code> </td><td>cpuset specification to set (use <code></code>, and <code>-</code> to specify multiple CPUs and ranges, <code>*</code> = don't change) </td></tr>
</table>
</dd></dl>
<p><b>iocShell:</b> Modify a thread's real-time properties. </p>

<p>Definition at line <a class="el" href="thread_rules_8c_source.html#l00289">289</a> of file <a class="el" href="thread_rules_8c_source.html">threadRules.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga18d12b853a486a8761c8e69a2169d550"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">epicsShareFunc long mcoreThreadRuleAdd </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>policy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>priority</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>cpus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pattern</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><b>iocShell:</b> Add or replace a thread rule. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>rule name (identifier) </td></tr>
    <tr><td class="paramname">policy</td><td>scheduling policy to set (<code>*</code> = don't change) </td></tr>
    <tr><td class="paramname">priority</td><td>scheduling priority (OSI) to set (a <code>+</code> or <code>-</code> sign adds to the current priority, <code>*</code> = don't change) </td></tr>
    <tr><td class="paramname">cpus</td><td>cpuset specification to set (use <code></code>, and <code>-</code> to specify multiple CPUs and ranges, <code>*</code> = don't change) </td></tr>
    <tr><td class="paramname">pattern</td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man7/regex.7.html">regex(7)</a> pattern to match thread names against </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>(OK, ERROR) as (0,-1)</dd></dl>
<dl class="section user"><dt>IOC Shell</dt><dd><code><b>mcoreThreadRuleAdd name policy priority cpus pattern</b></code> <table  border="0">
<tr>
<td><code>name</code> </td><td>rule name (identifier) </td></tr>
<tr>
<td><code>policy</code> </td><td>scheduling policy to set (<code>*</code> = don't change) </td></tr>
<tr>
<td><code>priority</code> </td><td>scheduling priority (OSI) to set (a <code>+</code> or <code>-</code> sign adds to the current priority, <code>*</code> = don't change) </td></tr>
<tr>
<td><code>cpus</code> </td><td>cpuset specification to set (use <code></code>, and <code>-</code> to specify multiple CPUs and ranges, <code>*</code> = don't change) </td></tr>
<tr>
<td><code>pattern</code>  </td><td><a href="http://www.kernel.org/doc/man-pages/online/pages/man7/regex.7.html">regex(7)</a> pattern to match thread names against </td></tr>
</table>
</dd></dl>
<p><b>iocShell:</b> Add or replace a thread rule. </p>

<p>Definition at line <a class="el" href="thread_rules_8c_source.html#l00109">109</a> of file <a class="el" href="thread_rules_8c_source.html">threadRules.c</a>.</p>

</div>
</div>
<a class="anchor" id="ga82b39f3e0f24bed2e91885b4b96d9cb1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">epicsShareFunc void mcoreThreadRuleDelete </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><b>iocShell:</b> Delete a thread rule. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>name (identifier) of the rule to delete</td></tr>
  </table>
  </dd>
</dl>
<dl class="section user"><dt>IOC Shell</dt><dd><code><b>mcoreThreadRuleDelete name</b></code> <table  border="0">
<tr>
<td><code>name</code> </td><td>name (identifier) of the rule to delete </td></tr>
</table>
</dd></dl>
<p><b>iocShell:</b> Delete a thread rule. </p>

<p>Definition at line <a class="el" href="thread_rules_8c_source.html#l00140">140</a> of file <a class="el" href="thread_rules_8c_source.html">threadRules.c</a>.</p>

</div>
</div>
<a class="anchor" id="gaf806b02cc93c8809e5ebe7104a9d699b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">epicsShareFunc void mcoreThreadRulesInit </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialization routine. </p>
<p>Must be called before using any of the other functions, which is done when registering the iocsh commands. </p>

<p>Definition at line <a class="el" href="thread_rules_8c_source.html#l00377">377</a> of file <a class="el" href="thread_rules_8c_source.html">threadRules.c</a>.</p>

</div>
</div>
<a class="anchor" id="gad22f782c58f3b2550b718cd3c25d7898"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">epicsShareFunc void mcoreThreadRulesShow </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p><b>iocShell:</b> Print a comprehensive list of the thread rules. </p>
<p>Rule names are shortened to 16 characters.</p>
<dl class="section user"><dt>IOC Shell</dt><dd><code><b>mcoreThreadRulesShow</b></code></dd></dl>
<p><b>iocShell:</b> Print a comprehensive list of the thread rules. </p>

<p>Definition at line <a class="el" href="thread_rules_8c_source.html#l00165">165</a> of file <a class="el" href="thread_rules_8c_source.html">threadRules.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Apr 21 2015 17:11:01 for EPICS Multi-Core Utilities by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.8
</small></address>
</body>
</html>
